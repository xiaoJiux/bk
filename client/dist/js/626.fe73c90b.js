"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[626],{3626:function(e,s,a){a.r(s),a.d(s,{default:function(){return u}});var t=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{attrs:{id:"UserInfo"}},[""===e.userInfo._id?a("article",{staticClass:"notLogin"},[a("h2",[e._v("温馨提示")]),a("p",[e._v("您暂时还未登录,请登录后再尝试!!! "),a("router-link",{attrs:{to:"/"}},[e._v("点击返回首页")])],1)]):a("article",{staticClass:"setting"},[a("el-tabs",{staticStyle:{"min-height":"200px"},attrs:{"tab-position":"left"}},[a("el-tab-pane",{attrs:{label:"账户信息"}},[a("div",{staticClass:"userTx"},[a("span",[e._v("用户头像")]),a("div",{staticClass:"img",style:{backgroundImage:"url("+e.urlBase+e.userInfo.tx+")"}})]),a("el-descriptions",{attrs:{column:1,labelStyle:e.labelStyle,contentStyle:e.labelStyle}},[a("el-descriptions-item",{attrs:{label:"用户名"}},[e._v(e._s(e.userInfo.username))]),a("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(e._s(void 0===e.userInfo.email?"暂时还未绑定邮箱":e.userInfo.email)+" ")]),a("el-descriptions-item",{attrs:{label:"注册时间"}},[e._v(e._s(e._f("fmtTime")(e.userInfo.regTime)))])],1)],1),a("el-tab-pane",{attrs:{label:"更改头像"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar",action:e.urlBase+"/upload/tx","show-file-list":!1,"with-credentials":!0,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.imageUrl?a("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("el-tab-pane",{attrs:{label:"更改用户名"}},[a("el-form",{ref:"nameForm",staticClass:"demo-ruleForm",attrs:{model:e.nameForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("p",{staticClass:"username"},[e._v("用户名: "),a("span",[e._v(e._s(e.userInfo.username))])]),a("el-form-item",{attrs:{label:"新用户名",prop:"newName"}},[a("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:e.nameForm.newName,callback:function(s){e.$set(e.nameForm,"newName",s)},expression:"nameForm.newName"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.submitName("nameForm")}}},[e._v("提交")])],1)],1)],1),a("el-tab-pane",{attrs:{label:"更改密码"}},[a("el-form",{ref:"passForm",staticClass:"demo-ruleForm",attrs:{model:e.passForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"旧密码",prop:"oldPass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.passForm.oldPass,callback:function(s){e.$set(e.passForm,"oldPass",s)},expression:"passForm.oldPass"}})],1),a("el-form-item",{attrs:{label:"新密码",prop:"newPass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.passForm.newPass,callback:function(s){e.$set(e.passForm,"newPass",s)},expression:"passForm.newPass"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"newPass2"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.passForm.newPass2,callback:function(s){e.$set(e.passForm,"newPass2",s)},expression:"passForm.newPass2"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.submitPass("passForm")}}},[e._v("提交")]),a("el-button",{on:{click:function(s){return e.resetPass("ruleForm")}}},[e._v("重置")])],1)],1)],1)],1)],1)])},r=[],l=(a(1703),a(4665)),o={name:"UserInfo",computed:{...(0,l.rn)(["userInfo"])},data(){return{urlBase:"",labelStyle:{"font-size":"18px","margin-bottom":"10px"},passForm:{oldPass:"",newPass:"",newPass2:""},nameForm:{newName:""},imageUrl:"",rules:{username:[{validator(e,s,a){/^[\w\u4e00-\u9fa5]{2,8}$/.test(s)?a():a(new Error("用户名不满足规则"))},required:!0,trigger:"blur"}],newPass:[{validator(e,s,a){/^[\w\[\]\/\\\-!@#$%^&*()+=|,.<>?:;"'{}]{6,18}$/.test(s)?a():a(new Error("密码不满足规则"))},required:!0,trigger:"blur"}],newPass2:[{validator:(e,s,a)=>{s===this.passForm.newPass?a():a("两次输入密码不一致")},required:!0,trigger:"blur"}],oldPass:[{validator(e,s,a){/^[\w\[\]\/\\\-!@#$%^&*()+=|,.<>?:;"'{}]{6,18}$/.test(s)?a():a(new Error("密码不满足规则"))},required:!0,trigger:"blur"}]}}},methods:{...(0,l.OI)(["logout"]),submitPass(e){this.$refs[e].validate((async e=>{if(e){let{data:e}=await this.$axios({method:"post",url:"/update/pass",data:{oldpassword:this.passForm.oldPass,newpassword:this.passForm.newPass,_id:this.userInfo._id}});console.log(e),this.logout()}}))},submitName(e){this.$refs[e].validate((async e=>{if(!e)return!1;{let{data:e}=await this.$axios({method:"post",url:"/update/name",data:{newName:this.nameForm.newName}});if(0!==e.code)return this.$message.error(e.msg);this.$message({type:"success",duration:1e3,message:"更新成功",onClose(){window.location.reload()}})}}))},handleAvatarSuccess(e,s){this.imageUrl=URL.createObjectURL(s.raw),this.$message({type:"success",message:"上传成功",duration:1e3,onClose(){window.location.reload()}})},beforeAvatarUpload(e){let s=/^image\/(gif|jpeg|png)$/.test(e.type),a=e.size/1024/1024<2;return s||this.$message.error("上传头像必须是jpg/png/gif图片"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),s&&a},resetPass(e){this.$refs[e].resetFields()}}},i=o,n=a(1001),m=(0,n.Z)(i,t,r,!1,null,"0425af0d",null),u=m.exports}}]);
//# sourceMappingURL=626.fe73c90b.js.map