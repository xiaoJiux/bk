"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[636],{4636:function(s,e,i){i.r(e),i.d(e,{default:function(){return d}});var t=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{attrs:{id:"Message"}},[t("div",{staticClass:"top"},[t("img",{attrs:{src:i(1477),alt:""}}),t("div",{staticClass:"right"},[t("h2",[s._v("留言板")]),t("p",[s._v("请文明发言哦！不然小心禁言、拉黑套餐>.<")]),t("el-input",{attrs:{rows:10,type:"textarea",placeholder:"请输入内容",maxlength:"120","show-word-limit":""},model:{value:s.textarea,callback:function(e){s.textarea=e},expression:"textarea"}}),t("div",{staticClass:"btn"},[t("i",{staticClass:"iconfont icon-biaoqing",on:{click:function(e){return e.stopPropagation(),s.handleToggleEmoji.apply(null,arguments)}}}),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:s.handleMsgSubmit}},[s._v("发表")]),t("div",{directives:[{name:"show",rawName:"v-show",value:s.showEmoji,expression:"showEmoji"}],staticClass:"emoji",on:{click:function(s){s.stopPropagation()}}},[t("ul",s._l(s.emoji,(function(e){return t("li",{on:{click:function(i){return s.handleEmojiClick(e)}}},[s._v(" "+s._s(e)+" ")])})),0)]),t("div",{staticClass:"clear"})],1)],1)]),t("article",{staticClass:"content"},[t("ul",s._l(s.msgData,(function(e){return t("li",[t("div",{staticClass:"parent"},[t("div",{staticClass:"left"},[t("img",{attrs:{src:s.urlBase+e.user.tx,alt:""}})]),t("div",{staticClass:"right"},[t("div",{staticClass:"name-time"},[t("span",[s._v(s._s(e.user.username))]),t("span",[s._v(s._s(s._f("fmtTime")(e.time)))])]),t("div",{staticClass:"message"},[s._v(" "+s._s(e.msg)+" ")]),t("div",{staticClass:"like-reply"},[t("i",{staticClass:"like iconfont icon-xinaixin",class:{isLike:-1!==e.likes.indexOf(s.userInfo._id)},on:{click:function(i){return s.handleLikesClick(e,e)}}}),t("span",[s._v(s._s(e.likes.length))]),t("i",{staticClass:"reply iconfont icon-huifu",on:{click:function(i){return s.handleReplyClick(e,e)}}})])])]),s._l(e.children,(function(i,a){return t("div",{staticClass:"child"},[t("div",{staticClass:"left"},[t("img",{attrs:{src:s.urlBase+i.user.tx,alt:""}})]),t("div",{staticClass:"right"},[t("div",{staticClass:"name-time"},[t("span",[s._v(s._s(i.user.username))]),t("span",[s._v(s._s(s._f("fmtTime")(i.time)))])]),t("div",{staticClass:"message"},[t("span",[s._v("@"+s._s(i.reply.username))]),s._v(" "+s._s(i.msg)+" ")]),t("div",{staticClass:"like-reply"},[t("i",{staticClass:"like iconfont icon-xinaixin",class:{isLike:-1!==i.likes.indexOf(s.userInfo._id)},on:{click:function(t){return s.handleLikesClick(e,i,a)}}}),t("span",[s._v(s._s(i.likes.length))]),t("i",{staticClass:"reply iconfont icon-huifu",on:{click:function(t){return s.handleReplyClick(e,i)}}})])])])})),t("div",{staticClass:"replyInput",class:{show:e.isShowReply}},[t("el-input",{attrs:{placeholder:"@"+e.replyUser.username,size:"mini"},model:{value:e.replyTxt,callback:function(i){s.$set(e,"replyTxt",i)},expression:"item.replyTxt"}}),t("el-button",{staticClass:"replyBtn",attrs:{type:"primary",size:"mini"},on:{click:function(i){return s.handleReplyInputClick(e)}}},[s._v("回复 ")]),t("div",{staticClass:"clear"})],1)],2)})),0)])])},a=[],l=i(4665),n={name:"Message",data(){return{textarea:"",showEmoji:!1,showEmail:[],emoji:["😃","😁","😂","😊","🙃","🥰","😘","🤭","🤔","😏","😵","😟","🙁","😳","😰","😭","😖","😡","😠","😈","🤡","☠️","👻","🙈","🙉","❤️","💖","💢","💣","💤","👋","👍","👌","🤞","🤟","🤙","👊","🖕","🤝","🙏","🙅","🙅‍♂️","👨‍✈️","👩‍✈️","👷","👷‍♀️","🤦","🤦‍♂️","👴","🧓","🐴","🐮","🐖","🐑","🐓","🦚","🐲","🐳","🐟","🐌"],msgData:[]}},computed:{...(0,l.rn)(["userInfo"])},methods:{handleToggleEmoji(){this.showEmoji=!this.showEmoji},handleEmojiClick(s){this.textarea+=s,this.showEmoji=!1},async handleMsgSubmit(){let s=this.textarea.trim(),e=this.userInfo._id;if(!e)return this.$message.error("请先登录");if(!s)return this.$message.error("请先输入留言内容");let{data:i}=await this.$axios({method:"post",url:"/msg",data:{msg:s,userId:e}});if(0!==i.code)return this.$message.error(i.msg);this.$message({type:"success",message:"留言发表成功",duration:1e3,onClose(){window.location.reload()}})},async getMsgList(){let{data:{data:s}}=await this.$axios({method:"get",url:"/msg"});s.filter((s=>{s.replyTxt="",s.replyUser={...s.user},s.isShowReply=!1})),this.msgData=s},async handleLikesClick(s,e,i){let t=this.userInfo._id;if(!t)return this.$message.error("请先登录");let a=e.likes,l=a.indexOf(t);-1!==l?a.splice(l,1):a.push(t),await this.$axios({method:"post",url:"/msg/like",data:{parentId:s._id,childId:e._id,likes:a,childIndex:i}})},async handleReplyClick(s,e){e.user._id===s.replyUser._id&&s.isShowReply?s.isShowReply=!1:(s.replyUser=e.user,s.isShowReply=!0)},async handleReplyInputClick(s){let e=s.replyTxt.trim(),i=this.userInfo._id,t=s.replyUser._id;if(!e)return this.$message.error("请先输入回复内容");if(!i)return this.$message.error("请先登录！");let a=s._id,l={msg:e,user:i,reply:t},{data:n}=await this.$axios({method:"post",url:"/msg/reply",data:{msgId:a,child:l}});if(0!==n.code)return this.$message.error(n.code);this.$message({type:"success",message:"回复成功",duration:1e3,onClose(){window.location.reload()}})}},mounted(){document.addEventListener("click",(()=>{this.showEmoji=!1})),this.getMsgList()}},r=n,o=i(1001),c=(0,o.Z)(r,t,a,!1,null,"10c76290",null),d=c.exports},1477:function(s,e,i){s.exports=i.p+"img/card.aeed69d4.png"}}]);
//# sourceMappingURL=636.3f7a409d.js.map