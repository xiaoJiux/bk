"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[636],{4636:function(e,t,s){s.r(t),s.d(t,{default:function(){return m}});var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"Message"}},[r("div",{staticClass:"top"},[r("img",{attrs:{src:s(1477),alt:""}}),r("div",{staticClass:"right"},[r("h2",[e._v("留言板")]),r("p",[e._v("请文明发言哦！不然小心禁言、拉黑套餐>.<")]),r("el-input",{attrs:{rows:10,type:"textarea",placeholder:"请输入内容",maxlength:"120","show-word-limit":""},model:{value:e.textarea,callback:function(t){e.textarea=t},expression:"textarea"}}),r("div",{staticClass:"btn"},[r("i",{staticClass:"iconfont icon-biaoqing",on:{click:function(t){return t.stopPropagation(),e.handleToggleEmoji.apply(null,arguments)}}}),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleMsgSubmit}},[e._v("发表")]),r("div",{directives:[{name:"show",rawName:"v-show",value:e.showEmoji,expression:"showEmoji"}],staticClass:"emoji",on:{click:function(e){e.stopPropagation()}}},[r("ul",e._l(e.emoji,(function(t){return r("li",{on:{click:function(s){return e.handleEmojiClick(t)}}},[e._v(" "+e._s(t)+" ")])})),0)]),r("div",{staticClass:"clear"})],1)],1)]),r("article",{staticClass:"content"},[r("ul",e._l(e.msgData,(function(t){return r("li",[r("div",{staticClass:"parent"},[r("div",{staticClass:"left"},[r("img",{attrs:{src:e.urlBase+t.user.tx,alt:""}})]),r("div",{staticClass:"right"},[r("div",{staticClass:"name-time"},[r("span",[e._v(e._s(t.user.username))]),r("span",[e._v(e._s(e._f("fmtTime")(t.time)))])]),r("div",{staticClass:"message"},[e._v(" "+e._s(t.msg)+" ")]),r("div",{staticClass:"like-reply"},[r("i",{staticClass:"like iconfont icon-xinaixin",class:{isLike:-1!==t.likes.indexOf(e.userInfo._id)},on:{click:function(s){return e.handleLikesClick(t,t)}}}),r("span",[e._v(e._s(t.likes.length))]),r("i",{staticClass:"reply iconfont icon-huifu",on:{click:function(s){return e.handleReplyClick(t,t)}}})])])]),e._l(t.children,(function(s,i){return r("div",{staticClass:"child"},[r("div",{staticClass:"left"},[r("img",{attrs:{src:e.urlBase+s.user.tx,alt:""}})]),r("div",{staticClass:"right"},[r("div",{staticClass:"name-time"},[r("span",[e._v(e._s(s.user.username))]),r("span",[e._v(e._s(e._f("fmtTime")(s.time)))])]),r("div",{staticClass:"message"},[r("span",[e._v("@"+e._s(s.reply.username))]),e._v(" "+e._s(s.msg)+" ")]),r("div",{staticClass:"like-reply"},[r("i",{staticClass:"like iconfont icon-xinaixin",class:{isLike:-1!==s.likes.indexOf(e.userInfo._id)},on:{click:function(r){return e.handleLikesClick(t,s,i)}}}),r("span",[e._v(e._s(s.likes.length))]),r("i",{staticClass:"reply iconfont icon-huifu",on:{click:function(r){return e.handleReplyClick(t,s)}}})])])])})),r("div",{staticClass:"replyInput",class:{show:t.isShowReply}},[r("el-input",{attrs:{placeholder:"@"+t.replyUser.username,size:"mini"},model:{value:t.replyTxt,callback:function(s){e.$set(t,"replyTxt",s)},expression:"item.replyTxt"}}),r("el-button",{staticClass:"replyBtn",attrs:{type:"primary",size:"mini"},on:{click:function(s){return e.handleReplyInputClick(t)}}},[e._v("回复 ")]),r("div",{staticClass:"clear"})],1)],2)})),0)])])},i=[],n=s(6198),a=s(3019),c=(s(8975),s(3210),s(7327),s(1539),s(561),s(4665)),l={name:"Message",data:function(){return{textarea:"",showEmoji:!1,showEmail:[],emoji:["😃","😁","😂","😊","🙃","🥰","😘","🤭","🤔","😏","😵","😟","🙁","😳","😰","😭","😖","😡","😠","😈","🤡","☠️","👻","🙈","🙉","❤️","💖","💢","💣","💤","👋","👍","👌","🤞","🤟","🤙","👊","🖕","🤝","🙏","🙅","🙅‍♂️","👨‍✈️","👩‍✈️","👷","👷‍♀️","🤦","🤦‍♂️","👴","🧓","🐴","🐮","🐖","🐑","🐓","🦚","🐲","🐳","🐟","🐌"],msgData:[]}},computed:(0,a.Z)({},(0,c.rn)(["userInfo"])),methods:{handleToggleEmoji:function(){this.showEmoji=!this.showEmoji},handleEmojiClick:function(e){this.textarea+=e,this.showEmoji=!1},handleMsgSubmit:function(){var e=this;return(0,n.Z)(regeneratorRuntime.mark((function t(){var s,r,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=e.textarea.trim(),r=e.userInfo._id,r){t.next=4;break}return t.abrupt("return",e.$message.error("请先登录"));case 4:if(s){t.next=6;break}return t.abrupt("return",e.$message.error("请先输入留言内容"));case 6:return t.next=8,e.$axios({method:"post",url:"/msg",data:{msg:s,userId:r}});case 8:if(i=t.sent,n=i.data,0===n.code){t.next=12;break}return t.abrupt("return",e.$message.error(n.msg));case 12:e.$message({type:"success",message:"留言发表成功",duration:1e3,onClose:function(){window.location.reload()}});case 13:case"end":return t.stop()}}),t)})))()},getMsgList:function(){var e=this;return(0,n.Z)(regeneratorRuntime.mark((function t(){var s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$axios({method:"get",url:"/msg"});case 2:s=t.sent,r=s.data.data,r.filter((function(e){e.replyTxt="",e.replyUser=(0,a.Z)({},e.user),e.isShowReply=!1})),e.msgData=r;case 6:case"end":return t.stop()}}),t)})))()},handleLikesClick:function(e,t,s){var r=this;return(0,n.Z)(regeneratorRuntime.mark((function i(){var n,a,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=r.userInfo._id,n){i.next=3;break}return i.abrupt("return",r.$message.error("请先登录"));case 3:return a=t.likes,c=a.indexOf(n),-1!==c?a.splice(c,1):a.push(n),i.next=8,r.$axios({method:"post",url:"/msg/like",data:{parentId:e._id,childId:t._id,likes:a,childIndex:s}});case 8:case"end":return i.stop()}}),i)})))()},handleReplyClick:function(e,t){return(0,n.Z)(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.user._id!==e.replyUser._id||!e.isShowReply){s.next=3;break}return e.isShowReply=!1,s.abrupt("return");case 3:e.replyUser=t.user,e.isShowReply=!0;case 5:case"end":return s.stop()}}),s)})))()},handleReplyInputClick:function(e){var t=this;return(0,n.Z)(regeneratorRuntime.mark((function s(){var r,i,n,a,c,l,o;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(r=e.replyTxt.trim(),i=t.userInfo._id,n=e.replyUser._id,r){s.next=5;break}return s.abrupt("return",t.$message.error("请先输入回复内容"));case 5:if(i){s.next=7;break}return s.abrupt("return",t.$message.error("请先登录！"));case 7:return a=e._id,c={msg:r,user:i,reply:n},s.next=10,t.$axios({method:"post",url:"/msg/reply",data:{msgId:a,child:c}});case 10:if(l=s.sent,o=l.data,0===o.code){s.next=14;break}return s.abrupt("return",t.$message.error(o.code));case 14:t.$message({type:"success",message:"回复成功",duration:1e3,onClose:function(){window.location.reload()}});case 15:case"end":return s.stop()}}),s)})))()}},mounted:function(){var e=this;document.addEventListener("click",(function(){e.showEmoji=!1})),this.getMsgList()}},o=l,u=s(1001),d=(0,u.Z)(o,r,i,!1,null,"10c76290",null),m=d.exports},1477:function(e,t,s){e.exports=s.p+"img/card.aeed69d4.png"}}]);
//# sourceMappingURL=636-legacy.1689832b.js.map